## MetaExploit - Hacking

  - exploits : méthode d'attaque à utiliser
  - auxiliary : outils de scan ( port de machine cible ou service )
  - post: outils qui accède à des donné confidentielle comme mdp/id de service ou appli
  - encoders: outils qui dissimule des payloads ou des exploits en créant des couches de code sélectionné par l'attaquant selon le system utiliser sur la machine cible
  - payloads: code que l'attaquant souhaite exécuter sur la machine cible peut être + simple que de configurer un exploits
  - nops: code qui permette de faire fonctionner un exploit ou payload sur une machine ou d'autre extension utilisant une structure spécifique ( php )

Pour montrer les exploits, les auxiliére , post, encoders, payloads, nops :

    $ show exploits
    $ show auxiliary
    $ show post
    $ show encoders
    $ show payloads
    $ show nops

## Collecte passive/indirect avec whois:


    whois site_cibler
    whois root-me.org

renseignement sur une machine sans toucher à son système
Savoir son : Architecture,les responsable du réseau, son système d'exploitation,
type du serveur web utilisé sur le réseau cible,
Date de création, ndd , date de maj, id domain ,hebergeur.....

On peut egalement chercher sur [Netcraft](https://searchdns.netcraft.com/)
Taper l'adresse du site en question : http://www.root-me.org
( obtention d'ip.. )

    whois ip_obtenu
    whois 212.129.28.16


## suite

Autre outils de collecte passive/indirecte : ( nslookup )

commande :

    $ nslookup
    $ set type=mx
    $ root-me.org

On obtient un echanger mail rediriger sur OVH.NET

Condition d'intrusion : le serveur mail redirect.ovh.net
une recherche rapide sur ces serveurs : un tier herberge ce web ,
ce tier ne rentre pas dans le cadre d'intrusion

Avant de de pouvoir s'introduire il faut passer a la recherche active

Collecte Active  ( TEST REALISER UNIQUEMENT EN MACHINE VIRTUELLE )
intergagir directement avec le system de la machine cible
(Scan de port , voir ceux qui sont ouvert
Determiner programme ou service en cours d'execution )

## Outils Active : (nmap )

(Sur terminal)

    $ nmap -h ( pour l'aide )
    Liste dispo pour faire des scan

Syntaxe :
-v execution d'un scan en mode verbeux ( affichera en temps reel l'evolution du scan
-sS permet de determiner si les port sont ouvert ou pas , ou filtrer
-pn  demande a nmaps lors d'un scan de ne pas utiliser de requete ping quand le system est actif
     utilise pour dissimuler les requetes ping ( la plus part des reseaux n'accepte pas les ping )

Commande pour machine virtuelle :
    $ nmap -v -sS 192.168.182.129

Detecte les port ouvert , l'etat de ses port ( filtrer ou fermer )
et la liste des service assosier a chaque port

    $ nmap -v -sS -A -192.168.182.129

resultat : numero de port , ouvert etat filtrer ou fermer
Les service + leurs version
+ OS + version


(Sur msf console)
    $ msf>db_nmap -v -sS -A 192.168.182.129

Le resultat sera enregistrer dans la bdd de metasploit

    $ msf>db_hosts

Pour voir si il a bien enregistrer le system d'exploitation cibler

    $ msf>db_services

Pour voir les services enregistrer dans la db avec les ports


Pour enregistrer sans metasploit et générer un fichier de resultat de scan en .xml

    $ nmap -v -sS -A -oX Nom_Donner_Au_Fichier_Qu'on_Crée 192.168.182.129
    $ nmap -v -sS -A -oX scanmetasploitable 192.168.182.129

Dossier crer dans raccourcis>Dossier personell

Importer le resultat du fichier Xml dans metasploit
msf>db_import Nom_Du_fichier_a_recuperer
msf>db_import scanmetasploitable

importe le resultat nmap en xml, depuis l'ordinateur
Retaper

    $ msf>db_services

Pour voir si c'est bien enregistrer

Autre outils de scan Dans metasploit en utilisant les auxiliary

Methode de scan via nmap scan de port tcp furtif , qui permet d'executer un scan furtif d'une
cible en usurpantt l'adresse ip d'une autre machine connecter sur son méme reseaux

Localiser un hote inactif sur le reseaux de la cible

module a utilisé : ipidseq
    $ msf> search ipidseq
Resultat> auxiliary/scanner/ip/ipidseq

Utiliser et parametrer ce module afin rechercher les hotes inactif sur le reseaux cible :

    $ msf>use auxiliary/scanner/ip/ipidseq
Le module est prét a etre parametrer

    $ msf>show options

pour voir les options a parametrer
Resultat : nom , ce qui est requi a parametrer ou non
Voir dans current setting ce qui est deja rempli ou non

Reste a modifier l'hote cibler
RHOSTS = Nom de l'option

    $ msf> set RHOSTS 192.168.182.0/24

( .0/24    24 = masque de sous reseaux jcp pk..)

Modifier la vitesse du scan
THREADS = nom de l'option
msf> set THREADS 5


Pour lancer :
    $ msf> exploit

( Trouve les adresse ip hors ligne ..... )
Pas de machine virtuelle donc pas d'adresse ip apparante
sinon on trouve :
192.168.182.2 ( selon reseau )
ip trouver =  machine hors ligne sur le reseaux de la machine cibler
PN = Sans ping

msf auxiliary(ipidseq)>nmap -PN -sI Adrese_ip_trouver 192.168.182.129
msf auxiliary(ipidseq)>nmap -PN -sI 192.168.182.2  192.168.182.129

aprés l'adresse ip trouver c'est la machine metasploitable2 qui est demarer - Machine virtuelle

Effectue une requette de scan la machine eteinte sur le reseaux de la machine metasploitable vers la machine virtuelle


resultat : port , etat , service ,
pratique que la machine cibler n'est pas toute seul sur son reseaux

     $ msf>back

Pour lacher le module en cours
    $ msf>clear
pour netoyer la fenetre

## Autre scan fonctionnant sous les service metasploit

Exemple, on a compromis la machine, system metasploitable est derriére un pare feu

    $ msf>search portscan

Retourne des module , a utilisé c'est syn avec son chemin en resultat
auxiliary/scanner/portscan/syn

    $ msf> use auxiliary/scanner/portscan/syn

    $ msf> show options

A renseigner RHOST, nom de machine cible  

    $ msf> set RHOSTS 192.168.182.192
    $ msf>show options

pour voir si le parametre a bien ete enregistrer

    $ msf>exploit

Pour lancer

on trouve une liste de port tcp ouvert
On trouve d'autre vecteur d'exploitation possible


# Scan + cibler

Scan de serveur ssh

    $ msf>db_services

pour chercher dans la bdd le port ssh ouvert
pour exploiter un port , determiner la version sur la cible du port/ssh

    $ msf>search ssh_version

resultat : auxiliary/scanner/ssh/ssh_version  ( scanner et trouver la versionssh du port )

msf>use auxiliary/scanner/ssh/ssh_version
msf>show options

Modifier RHOSTS sur l'adresse : 192.168.182.129
on verifie que c'est sur le bon port et on lance !
msf>exploit

On a la version du port SSH si on l'avait pas avant


# Scan de serveur ftp

    $ msf>db_services

 pour chercher dans la bdd le port ftp ouvert

pour chercher dans la bdd le port ftp ouvert
pour exploiter un port , determiner la version sur la cible du port/ssh


    $ msf>search ftp_version

resultat : auxiliary/scanner/ftp/ftp_version  ( scanner et trouver la version ftp du port )

Meme fonctionnement que le précédent

si ce serveurs peut etablir une connecion anodyne

en utilisant le module suivant

    $ msf>search anonymous

resultat : auxiliary/scanner/ftp/anonymous

Pour essayer d'avoir la detection d'un accés anonyme
Donc

    $ msf>use auxiliary/scanner/ftp/anonymous
    $ msf>show options

modifier le rhust et lancer le module

On obtient la lecture des fichier sur serveurs FTP
On peut avoir un accés anonyme ainsi que les droit de lecture sur ce serveur


A VOIR ::
https://www.youtube.com/watch?v=cX9WLmQaRu0   ( la suite part 2 )
https://www.youtube.com/watch?v=Ah5aq7w_LHk     ( part 3  )
